@page "/tenkey"
@page "/tenkey/{Param}"
@inject HttpClient Http
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime
@inject CommonDataService CommonData    // 共通変数

<PageTitle>10KEY</PageTitle>
<h3>数量入力</h3>
<div class="scanBarcode">@qrCodeValue</div>

<div class="centered-content">
    
    <div class="tenkey-container">
        <!-- Input display at the top -->
        <div class="input-display">
            <input type="text" @bind="InputValue" readonly />
        </div>

        <!-- 1-9 Number buttons -->
        @for (int number = 1; number <= 9; number++)
        {
            int currentNumber = number; // Capture the loop variable
            <button class="btn btn-primary" @onclick="() => AppendNumber(currentNumber)">
                @currentNumber.ToString()
            </button>
        }

        <!-- CLR button -->
        <button class="btn btn-secondary" @onclick="Clear">CLR</button>

        <!-- Zero button -->
        <button class="btn btn-primary" @onclick="() => AppendNumber(0)">0</button>

        <!-- ENT button -->
        <button class="btn btn-info" @onclick="NavigateToAnotherPage">ENT</button>
    </div>
</div>

@code {
    [Parameter]
    public string Param { get; set; }

    private string qrCodeValue = "QRコード:";
    private string InputValue { get; set; } = "";

    protected override void OnInitialized()
    {   //パラメーターセット
        //qrCodeValue = "BAR: " + Param;
        // バーコードセット
        qrCodeValue = "BAR: " + CommonData.scanData.バーコード;
    }

    private void AppendNumber(int number)
    {
        InputValue += number.ToString();
    }

    /// --------------------------------------------------------------------------------
    /// <summary>
    /// ENTERキー入力後、別のrazorページに移動
    /// </summary>
    /// --------------------------------------------------------------------------------
    private void NavigateToAnotherPage()
    {
        // ENTERキーで、数値入力画面終了
        if (InputValue == "")
        {
            InputValue = "0";
        }
        // 共通変数にデータセット
        CommonData.scanData.数量 = int.Parse(InputValue);
        ScanData data = new ScanData();
        data.バーコード = CommonData.scanData.バーコード;
        data.数量 = CommonData.scanData.数量;
        data.処理日時 = CommonData.scanData.処理日時;

        CommonData.scanDatas.Add(data);  // 1行追加
        CommonData.iCount++;    // カウントアップ

        JSRuntime.InvokeVoidAsync("playSound2");
        Task.Delay(1000);
        // 別のrazorページに移動
        NavigationManager.NavigateTo("/");
    }

    private void Clear()
    {
        InputValue = "";
    }
}
